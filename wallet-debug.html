<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet Detection Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .wallet-check {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .detected { border-left-color: #28a745; }
        .not-detected { border-left-color: #dc3545; }
        .status {
            font-weight: bold;
            color: #28a745;
        }
        .status.not-installed {
            color: #dc3545;
        }
        code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px 10px 0;
        }
        button:hover {
            background: #0056b3;
        }
        .debug-info {
            background: #f8f9fa;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Wallet Detection Debug Tool</h1>
        <p>This tool helps debug wallet detection issues. Check if your wallets are properly detected by the browser.</p>
        
        <button onclick="checkWallets()">üîÑ Refresh Detection</button>
        <button onclick="showFullWindow()">üîç Show Full Window Object</button>
        
        <div id="wallet-results"></div>
        
        <div class="debug-info">
            <h3>Detection Log:</h3>
            <div id="debug-log"></div>
        </div>
    </div>

    <script>
        function log(message) {
            const logElement = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }
        
        function checkHashPack() {
            log('=== HashPack Detection ===');
            
            // Check all possible HashPack injection points
            const checks = {
                'window.hashpack': window.hashpack,
                'window.HashPack': window.HashPack,
                'window.ethereum?.isHashPack': window.ethereum?.isHashPack,
                'window.hederaWallets?.hashpack': window.hederaWallets?.hashpack,
                'window.hedera': window.hedera
            };
            
            Object.entries(checks).forEach(([key, value]) => {
                log(`${key}: ${value !== undefined ? 'FOUND' : 'undefined'} (${typeof value})`);
                if (value && typeof value === 'object') {
                    log(`  - Object keys: ${Object.keys(value).join(', ')}`);
                }
            });
            
            // Check if HashPack injects anything else
            const hashpackRelated = Object.keys(window).filter(key => 
                key.toLowerCase().includes('hashpack') || 
                key.toLowerCase().includes('hash')
            );
            log(`HashPack-related window properties: ${hashpackRelated.join(', ')}`);
            
            return !!(window.hashpack || window.HashPack || window.ethereum?.isHashPack);
        }
        
        function checkWallets() {
            const resultsDiv = document.getElementById('wallet-results');
            log('Starting wallet detection check...');
            
            const wallets = [
                {
                    name: 'MetaMask',
                    check: () => !!(window.ethereum?.isMetaMask),
                    icon: 'ü¶ä'
                },
                {
                    name: 'HashPack',
                    check: checkHashPack,
                    icon: 'üî∑'
                },
                {
                    name: 'Blade Wallet',
                    check: () => !!(window.blade || window.Blade),
                    icon: '‚öîÔ∏è'
                },
                {
                    name: 'Kabila Wallet',
                    check: () => !!(window.kabila || window.Kabila),
                    icon: 'üîÆ'
                }
            ];
            
            let html = '<h2>üîç Wallet Detection Results</h2>';
            
            wallets.forEach(wallet => {
                const isDetected = wallet.check();
                const statusClass = isDetected ? 'detected' : 'not-detected';
                const statusText = isDetected ? 'INSTALLED ‚úÖ' : 'NOT DETECTED ‚ùå';
                const statusColor = isDetected ? '' : 'not-installed';
                
                html += `
                    <div class="wallet-check ${statusClass}">
                        <h3>${wallet.icon} ${wallet.name}</h3>
                        <p class="status ${statusColor}">${statusText}</p>
                    </div>
                `;
                
                log(`${wallet.name}: ${isDetected ? 'DETECTED' : 'NOT FOUND'}`);
            });
            
            resultsDiv.innerHTML = html;
        }
        
        function showFullWindow() {
            log('=== All Window Properties ===');
            const allKeys = Object.getOwnPropertyNames(window).sort();
            const relevantKeys = allKeys.filter(key => 
                key.toLowerCase().includes('ethereum') ||
                key.toLowerCase().includes('hashpack') ||
                key.toLowerCase().includes('blade') ||
                key.toLowerCase().includes('kabila') ||
                key.toLowerCase().includes('hedera') ||
                key.toLowerCase().includes('wallet')
            );
            
            log(`Wallet-related properties found: ${relevantKeys.length}`);
            relevantKeys.forEach(key => {
                const value = window[key];
                log(`${key}: ${typeof value} ${value ? '‚úÖ' : '‚ùå'}`);
            });
        }
        
        // Auto-check on load
        window.addEventListener('load', () => {
            log('Page loaded, checking wallets...');
            setTimeout(checkWallets, 1000); // Wait a bit for wallet injections
        });
        
        // Also check after a delay in case wallets inject asynchronously
        setTimeout(() => {
            log('Delayed check after 3 seconds...');
            checkWallets();
        }, 3000);
    </script>
</body>
</html>